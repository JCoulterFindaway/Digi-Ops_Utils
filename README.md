# Digi-Ops_Utils
Repo to house utility scripts I use for Digi-ops

Explanation of processes:

**New York Times Best Sellers Digital:**<br>
Report generated every Monday and emailed to a few individuals, Nyt bestseller date field in TRAP is updated.

Goal of process is to identify audiobooks in our system that are on the NYT Best Sellers List in specific categories.
Running `NYT_API_Best_Sellers.ipynb` will call the NYT API and return a csv that includes the current week's Best Sellers in specific categories. The results are used to set up a Vlookup against the historical accumulation of the reports generated by this process. To find new books that are not in the accumulated historical list it is necessary to search Gateway using Title and Author to find matches in our system. Once the report is completed for the current week it is emailed to Lauren Greve <lgreve@spotify.com>, Annie Pritchard <anniep@spotify.com>, Jamie Belardo <jamieb@spotify.com>. 
For each title in the current week's list, it is necessary to update the `Nyt bestseller date` field to the current week's date for each title in TRAP. To do this, the Content IDs from the current Best Sellers List are used in a SQL query against `findaway-etl-data-ingestion.trap_prod.audiobook_{date}` to find the corresponding TRAP Ids. The TRAP Ids are used to create an import file that updates the `Nyt bestseller date` for each title in TRAP to the date displayed on https://www.nytimes.com/books/best-sellers/ (this date is always the following Sunday).





**Awards update:**<br>
Awards are updated every two weeks generally on Monday.<br>
Awards are provided by the publisher but we are only interested in tracking certain provided awards and NYT Best Sellers <br><br>
Accepted award list = "Oprah's Book Club","YALSA Amazing Audiobooks for Young Adults","YALSA Best of the Best Winner","Hugo Award Winner","Caldecott Medal","Grammy Award","Man Booker Prize Winner","ALSC Notable Children's Recording","Alex Award Winner","Newbery Honor","Pulitzer Prize Winner","Edgar Award Winner","National Book Critics Circle Award Winner","Nebula Award Winner","PW Listen-Up Award Winner","Audie Award Winner","Nobel Prize Winner","Library Journal Best Audiobooks of Year","AudioFile Earphone Award Winner","Carnegie Medal in Literature","Newbery Medal Winner","National Book Award Winner","RUSA Notable Book","YALSA Amazing Audiobook","RITA Award","ITW Thriller Award","Odyssey Award","Coretta Scott King Award","Pura Belpre Award","Printz Award","William C. Morris Award","Sibert","Stonewall","American Indian Youth Literature","Asian / Pacific American Award","Sidney Taylor Book Award","Reese's Book Club","Good Morning America Book Club","YALSA Award Winner","Audie Audiobook of the Year Winner", "New York Times Best Seller"


Using Looker report TRAP - Audiobook Historical Changes https://lookerstudio.google.com/u/0/reporting/a7051785-b13d-470e-9e31-4fb813bb69f0/page/5LjRD a report of all titles that have had publisher provided awards updated during the prior two weeks is exported. This report includes relevant award metadata. `Awards_TRAP.ipynb` utilizes this report to filter the results to only the awards we are tracking (listed above).
`Awards_TRAP.ipynb` also uses the id lists from the prior two weeks of NYT Best Sellers to create a deduplicated combined list of titles; for our purposes NYT Best Sellers is considered an award but most publishers don't provide this via ONIX.

Using the combined list of titles with acceptable awards and NYT best sellers, the list of titles is compared via Vlookup, to a Looker Report of any title in TRAP with Awards to identify the titles that need to be updated. Awards are not removed from titles in TRAP regardless if they are removed from the title's incoming metadata.
TRAP Ids are identified via SQL query in `findaway-etl-data-ingestion.trap_prod.audiobook_{date}` to create an import file for TRAP to make the appropriate updates to the "Awards" field for each title.

(This process has recently been updated to use BigQuery instead of Looker but the logic remains the same)










